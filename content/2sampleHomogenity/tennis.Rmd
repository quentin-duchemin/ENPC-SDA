---
title: "Two sample homogeneity tests: tennis dataset"
output:
    html_document:
      code_download: true    
      theme: cosmo
      toc: true
      toc_float: true
      highlight: tango
      number_sections: true
---

To go back to the Home page, click [here](https://quentin-duchemin.github.io/ENPC-SDA/).


The data can be found [here](https://www.kaggle.com/jordangoblet/atp-tour-20002016/version/2?select=Data.csv).

```{r}
library('tidyverse')
data <- read_csv("../../data/tennis.csv");
```

# 1) Study of the big three

```{r}
big3 =  c('Federer R.','Nadal R.', 'Djokovic N.')
FvsN = ('Federer R.' == data$Winner[(data$Winner %in% big3[-3]) & (data$Loser %in% big3[-3])]);
FvsD = ('Federer R.' == data$Winner[(data$Winner %in% big3[-2]) & (data$Loser %in% big3[-2])]);
NvsD = ('Nadal R.' == data$Winner[(data$Winner %in% big3[-1]) & (data$Loser %in% big3[-1])]);
```


## a) Asymptotic Z-tests
```{r message = FALSE, warning = FALSE, echo = TRUE} 
computeZstat <- function (seq1,seq2,level=0.05) {
  n1 = length(seq1);
  n2 = length(seq2);
  bar1 = mean(seq1);
  bar2 = mean(seq2);
  bar = (sum(seq1)+sum(seq2))/(n1+n2);
  Zstat = sqrt(n1*n2/(n1+n2))*(bar1-bar2)/sqrt(bar*(1-bar));
  pvalue = 2*pnorm(-abs(Zstat),mean=0,sd=1);
  return (data.frame(stat=Zstat, pval=pvalue));
}
```

### Study of Federer

```{r}
resZtest <- computeZstat(FvsN,FvsD);
resZtest$pval
```

The p-value is equal to 0.2 meaning that we do not reject the null hypothesis. Hence, the probability of victory of Federer over Nadal is not statistically different from the one of Federer over Djokovic.

### Study of Nadal

```{r}
resZtest <- computeZstat(1-FvsN,NvsD);
resZtest$pval;
```
The p-value is equal to 0.04 meaning that we would tend to reject the null hypothesis. Hence, the probability of victory of Nadal over Federer is statistically different (larger) from the one of Nadal over Djokovic.

### Study of Djokovic

```{r}
resZtest <- computeZstat(1-FvsD,1-NvsD);
resZtest$pval;
```
The p-value is equal to 0.85 meaning that we do not reject the null hypothesis. Hence, the probability of victory of Djokovic over Federer is not statistically different from the one of Djokovic over Nadal.

*Conclusion*
While Nadal and Djokovic have a probability of victory against the other members of the Big 3 that does not depend on the opponent, we showed that Nadal has significantly less chance of winning against Djokovic than against Federer. 

Let us take a closer look to this fact by conducting the test on the different surfaces. We only focus on Clay and Hard Court since we do not have enough data for Carpet and Grass.

```{r}
Nadal_study <- function(df){
    list_surfaces = c("Clay","Hard");
    pvals = list();
    probasNadalvictory = data.frame(matrix(ncol=length(list_surfaces),nrow=2));
    colnames(probasNadalvictory) <- list_surfaces;
    rownames(probasNadalvictory) <- c('Federer R.', 'Djokovic N.');
    for (surface in list_surfaces){
      FvsNsurface = ('Federer R.' == df$Winner[(df$Winner %in% big3[-3]) & (df$Loser %in% big3[-3]) & (df$Surface == surface)]);
      NvsDsurface = ('Nadal R.' == df$Winner[(df$Winner %in% big3[-1]) & (df$Loser %in% big3[-1]) & (df$Surface == surface)]);
      resZtest <- computeZstat(1-FvsNsurface,NvsDsurface);
      pvals = append(pvals, resZtest$pval);
      probasNadalvictory['Federer R.',surface] <- mean(1-FvsNsurface);
      probasNadalvictory['Djokovic N.',surface] <- mean(NvsDsurface);
    }
    names(pvals) <- list_surfaces;
    return (list(pvals=pvals,probasvictory=probasNadalvictory));
}
```


```{r}
Nadal_res <- Nadal_study(data);
Nadal_res$pvals
Nadal_res$probasvictory
```


With a p-value=0.15 for Clay, we conclude that the difference between the probabilities of victory of Nadal against Federer or Djokovic are not statistically different (Nadal is known to be the King of Clay ;) ).
However, on Hard courts the p-value is 0.045 and we can conclude that Nadal has greater chances to win against Federer rather than Djokovic.


# 2) Understanding the temporal aspects of the previous fact.

## a) Before 2010

```{r}
dates <- apply(select(data, Date), 1, function(x){ as.integer(substr(x,nchar(x)-3,nchar(x)));});
Nadal_res <- Nadal_study(data[dates <= 2010,]);
Nadal_res$pvals
Nadal_res$probasvictory
```
## b) After 2010
```{r}
Nadal_res <- Nadal_study(data[dates > 2010,]);
Nadal_res$pvals
Nadal_res$probasvictory
```

We do not reject the null hypothesis for both Clay and Hard courts working with matches played before 2010. However, we reach the conclusions of the previous sections if we focus only on matches played after 2010.
This is easily understandable: Before 2010, Federer and Djokovic were both completely dominated by Nadal on Clay while they were both slightly better than Nadal on hard courts. After 2010, Federer was getting holder and it became difficult for him to compete with Nadal even on hard courts. On the contrary, Djokovic went from good to almost unbeatable from 2011.